<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nifty50 Stock Selector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 30px;
            padding: 20px;
            background-color: #f4f4f9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        select, button {
            padding: 10px;
            margin-top: 20px;
        }

        #error {
            color: red;
        }
    </style>
    <!-- Add PapaParse CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <h1>Select a Nifty50 Stock</h1>

    <div>
        <label for="stockSelect">Choose a stock: </label>
        <select id="stockSelect">
            <option value="" disabled selected>Select a stock</option>
        </select>
        <button onclick="showStockData()">Show Stock</button>
    </div>

    <div id="error"></div>
    <div id="stockData"></div>

    <script>
        // Fetch Nifty50 stocks list from GitHub
        async function fetchStocks() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/siddharthadeymohori121/StolkHolmes/main/nifty50_stocks.csv');
                const data = await response.text();

                // Parse CSV data using PapaParse
                Papa.parse(data, {
                    header: true, // Use first row as header
                    skipEmptyLines: true, // Skip empty lines
                    dynamicTyping: true, // Automatically cast numeric values
                    complete: function(results) {
                        const stocks = results.data;
                        const stockSelect = document.getElementById('stockSelect');

                        // Check if stocks data is available
                        if (stocks.length === 0) {
                            document.getElementById('error').textContent = 'No stocks data found.';
                            return;
                        }

                        // Populate the dropdown with stock symbols
                        stocks.forEach(stock => {
                            const stockSymbol = stock['Stock Symbol']; // Assuming the column name is 'Stock Symbol'
                            if (stockSymbol) {  // Ensure that stockSymbol is not undefined or empty
                                const option = document.createElement('option');
                                option.value = stockSymbol;
                                option.textContent = stockSymbol;
                                stockSelect.appendChild(option);
                            }
                        });
                    }
                });

            } catch (error) {
                console.error('Error loading stocks:', error);
                document.getElementById('error').textContent = 'Failed to load stock data.';
            }
        }

        // Show stock data in a table
        async function showStockData() {
            const selectedStock = document.getElementById('stockSelect').value;
            if (!selectedStock) {
                document.getElementById('error').textContent = 'Please select a stock!';
                return;
            }

            try {
                const response = await fetch('https://raw.githubusercontent.com/siddharthadeymohori121/StolkHolmes/main/nifty50_stocks.csv');
                const data = await response.text();

                // Parse CSV data using PapaParse
                Papa.parse(data, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: true,
                    complete: function(results) {
                        const stocks = results.data;
                        const stockData = stocks.find(stock => stock['Stock Symbol'] === selectedStock);

                        if (!stockData) {
                            document.getElementById('error').textContent = 'Stock data not found.';
                            return;
                        }

                        let tableHtml = '<table>';
                        tableHtml += '<tr><th>Stock Symbol</th><th>Company Name</th><th>Last Price</th><th>Market Cap</th></tr>';
                        tableHtml += `<tr>
                                        <td>${stockData['Stock Symbol']}</td>
                                        <td>${stockData['Company Name']}</td>
                                        <td>${stockData['Last Price']}</td>
                                        <td>${stockData['Market Cap']}</td>
                                    </tr>`;
                        tableHtml += '</table>';

                        document.getElementById('stockData').innerHTML = tableHtml;
                        document.getElementById('error').textContent = ''; // Clear any previous error message
                    }
                });

            } catch (error) {
                console.error('Error showing stock data:', error);
                document.getElementById('error').textContent = 'Failed to display stock data.';
            }
        }

        // Load stock list when the page loads
        window.onload = fetchStocks;
    </script>
</body>
</html>
